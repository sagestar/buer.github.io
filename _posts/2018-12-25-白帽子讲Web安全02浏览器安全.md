---
layout: post
title: '白帽子讲Web安全 02 浏览器安全'
date: 2018-12-25
author: Buer
color: rgb(255,210,32)
cover: 'http://qiniu.bueryo.com/18-12-26/42824015.jpg'
tags: 白帽子 Web安全 笔记 浏览器
---

# 浏览器安全

## 同源策略（Same Origin Policy）

这里是原文摘录：
> *浏览器最核心最基本的安全功能。Web是构建在同源策略的基础之上的，浏览器只是针对同源策略的一种实现。浏览器的同源策略，限制了来自不同源的“document”或脚本，对当前“document”读取或设置某些属性。来自不同源的对象无法互相干扰。*   
> *javascript中url（用来定义web网页地址）影响源的因素有：host（域名或IP地址，如果是IP地址则看做是一个根域名）、子域名、端口、协议（url格式：协议名：//主机名[:端口号]/[路径名/.../文件名]）。对于当前页面来说，页面内存放javascript文件的域并不重要，重要的是加载javascript页面所在的域是什么。*   
> *&lt;script&gt;、&lt;img&gt;、&lt;iframe&gt;、&lt;link&gt;等标签都可以跨域加载资源，不受同源策略的限制，但不能读、写返回的内容。对于浏览器来说，除了DOM、Cookie、XMLHttpRequest会受到同源策略的限制外，浏览器加载的一些第三方插件也有各自的同源策略。*

下面是我的理解：  
所谓同源策略，就是一个域内的脚本，只可以读写本域的资源，而无法访问其他的资源。  
同源策略的安全性与现阶段网站结构的复杂性成反比。现在网站并不是讲所有的文件都存在一个服务器上，至少会将web基本业务服务器和图片服务器分别运行在不同的主机上。所以现阶段浏览器在安全性和可用性之间找了一个平衡点，就是选择性的“开放了后门”，比方说允许img、script、style等标签跨域引用资源。*举个例子，有个朋友，在淘宝买了某产品，结果我们局域网中都会被推送相关的广告，因为我们使用同样的公网IP。*  
尽管浏览器会遵循同源策略，但是仍然会发现你访问过的页面、浏览过的产品、搜索过的字符串、甚至你的兴趣爱好，都可以被分析出来，然后收到相关的推送信息。我们姑且信任这些大数据分析者是有节操的，不会随意泄露这些数据。如果浏览器不遵循同源策略，结果会更糟。*（相关知识点，CSRF，后面会有。）*  
尽管浏览器都遵循远策略，但是仍然可以绕过同源的限制进行跨域。*（相关知识点，XSS，后面也会有。）*

## 浏览器沙箱

原文摘录：
>*Sandbox即沙箱，泛指“资源隔离类模块”的代名词，设计目的一般是为了让不可信任的代码运行在一定的环境中，限制不可信任的代码访问隔离区之外的资源。经过封装的API（应用程序编程接口）可以实现跨越Sandbox边界产生数据交换。*  
>*在网页中插入一段恶意代码，利用浏览器漏洞执行任意代码的攻击方式，被称为“挂马”。*  
>*浏览器的多进程架构，将浏览器的各个功能模块分开，各个浏览器实例分开，当一个进程崩溃时，也不会影响到其他的进程。*  

简单的来说，就是将页面解析、渲染、插件加载和运行等分别交由不同的模块处理，对于未知的威胁会有严格的检查过程。  
吹一波Google的Chrome浏览器，IE8以后的浏览器也使用了多进程的架构。

## 恶意网址拦截
原文：
>*恶意网址包括挂马加载的恶意网址，也包括钓鱼网站、诈骗网站。目前各个浏览器的拦截恶意网址的功能都是基于黑名单的。（浏览器周期性地从服务器端获取一份最新的恶意网址黑名单）*

常见的恶意网址分为两类：
+ 挂马网站，网站中有恶意脚本，可以执行shellcode，然后在用户电脑内植入木马。
+ 钓鱼网站，通过使用相似页面来欺骗用户。
对应的解法有厂商提供的黑名单，浏览器会周期去服务器获取。在打开可疑页面前，浏览器会有一个安全提示，例如是否继续访问。  
然后就是各种安全证书，例如EV SSL证书（Extended Validation SSL Certificate）。这个支持EV模式的浏览器在打开安全网站的时候会有特殊标志，例如带有锁的图标，或者在地址栏显示绿色的背景等。

## 高速发展的浏览器安全

IE8推出了XSS Filter，用以对抗反射型XSS。当用户访问的URL中含有XSS脚本时，IE会修改其中的关键字符，使攻击无法完成，并对用户弹出提示框。这是IE8的一大亮点，一直以来，XSS都被认为是服务器端的漏洞，应该由服务器端在代码中修补，也是因为微软推出了这个功能，使得IE8在安全领域极具特色。
Firefox4推出了CSP，做法是由服务器端返回一个HTTP头，这里面带有页面应该遵守的安全策略。但是由于CSP规则配置复杂，后期维护成本巨大，导致没有很好地推广，跟Firefox一个毛病^_^。  
多说一句，关于畸形URL，各个浏览器的处理方案各不相同，但是还需要用户的经验，对于可疑的网址，还是不要尝试打开的好。这一点实际上也是在不断进步的，现阶段有经验的人们往往会注意格式不对的网址，但是近一年来又出现了新的变种，例如用alpha的“α”来代替英文小写的a，这在一些字体里非常相似，但是计算机的字符解析则是完全不同……防不胜防啊，毕竟黑客也是在进步的。  
扩展和插件极大地丰富了浏览器的功能，但是安全问题也随之而来，插件本身也有可能会有恶意行为。并且插件和扩展权限都高于页面JavaScript的权限，所以……

## 小结
浏览器是互联网的重要入口，不能只重视服务器端漏洞。浏览器安全以同源策略为基础，加深理解同源策略，才能把握住浏览器安全的本质。在当前高速发展的形势下，恶意网址检测，插件安全越来越重要，紧跟浏览器发展的脚步来研究安全，才是安全研究者需要认真对待的事情。