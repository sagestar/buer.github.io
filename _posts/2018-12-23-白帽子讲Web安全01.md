---
layout: post
title: '白帽子讲Web安全 01'
date: 2018-12-23
author: Buer
color: rgb(255,210,32)
cover: 'http://qiniu.bueryo.com/bueryo/20180620221702.jpeg'
tags: 白帽子 Web安全 笔记
---


# 白帽子讲Web安全笔记 

## 安全三要素

### 机密性（Confidentiality）、完整性（Integrity ）、可用性（Availability ）。

    机密性要求保护数据内容不能泄露，加密是实现机密性要求的常见手段。  
    完整性要求保护数据内容是完整、没有被篡改。常见的保证一致性的技术手段是数字签名。  
    可用性要求保护资源是随需而得、随时可用。  
在安全领域中，最基本的要素就是这三个，后来还有人想扩充这些要素，增加了诸如**可审计性**、**不可抵赖性**等，但最最重要的还是以上三个要素。在设计安全方案时，也要以这三个要素为基本的出发点，去全面地思考所面对的问题。

## 安全评估过程

     4个阶段：资产等级划分、威胁分析、风险分析、制定解决方案。

这里需要插播一下：什么是威胁，什么是风险？这两个概念经常会被人混淆，弄清他们对于了解安全评估每阶段做的事情很重要。威胁，是指可能造成危害的来源，英文叫Threat，风险，是指可能会出现的损失，英文叫Risk。这里要明确一件事：虽然危害可能导致损失，但是危害≠损失。所以威胁分析，是要找到可能造成危害的来源，风险分析，就是在找到这些来源的基础上，分析他们可能造成的损失。

### 第一个阶段：资产等级划分

这项工作是所有安全评估工作的基础，这阶段的任务是：明确评估目标。应该可以再加一个：明确安全边界。
根据资产的重要性，划分资产等级。在互联网中，安全的核心问题，可能是数据的安全问题。所以做资产等级划分时，很重要的一个参考依据就是：按照数据的重要性确定与数据相关联的资产的重要性。怎么确定各类数据的重要性呢？主要通过访谈形式，当然，如果企业自己已经对数据做出了等级划分，就更好了。

划分完资产等级后，就开始划分安全域和安全边界，建立一个安全模型。后面的评估，就要围绕着安全边界的内部和外部来开展。

### 第二个阶段：威胁分析

白帽子和黑帽子对待安全问题的区别：白帽子是宏观的，他要找到所有弱点，不能有遗漏；而黑帽子就简单的多，他是微观的，只要突破一点就可以攻陷系统。白帽子防护系统比黑帽子入侵系统要难得多。所以，白帽子做安全评估，需要对系统的安全威胁做全面的分析，尽可能的找到所有安全弱点。  
虽然想找到所有安全弱点很难，但是也不是盲目乱找，有一些科学的威胁建模方法可以帮助我们较为全面的查找威胁。这里介绍较通用的STRIDE模型，最早由微软提出。  
STRIDE是6个单词的首字母缩写，我们在分析威胁时，可以从以下6个方面去考虑。  

|威胁|定义|对应的安全属性|
|:---|:--|:---|
|Spoofing（伪装）|冒充他人身份|认证|
|Tampering（篡改 ）|修改数据或者代码|完整性|
|Repudiation（抵赖）|否认做过的事|不可抵赖性|
|InformationDisclosure（信息泄露）|机密信息泄露|机密性|
|Denial of Service（拒绝服务）|拒绝服务|可用性|
|Elevation of Privilege（提升权限）|未经授权获得许可|授权|

在进行威胁分析时，要尽可能地不遗漏威胁，头脑风暴的过程可以帮助确定攻击面。 威胁分析模型也不是一成不变的，相反，它需要经常更新。

### 第三个阶段：风险分析

并非每个威胁都会造成难以承受的损失，一个威胁到底能够造成多大的危害，如何去衡量它？这就要考虑到风险了。我们判断风险高低的过程，就是风险分析的过程。  
风险由两个因素组成：发生的可能性、破坏性（Risk = Probability * Damage Potential）  
如何更科学地衡量风险，也相应模型可以帮助我们做判断，这里介绍DREAD模型，它也是由微软提出的。  

等级|高（3）|中（2）|低（1）
-|-|-|-
Damage Potential|获取完整验证权限；执行管理员操作；非法上传文件|泄露敏感信息|泄露其他信息
Reproducibility|攻击者可以随意再次攻击|攻击者可以重复攻击，但有时间限制|攻击者很难重复攻击
Exploitability|初学者在短期内能掌握攻击方法|熟练的攻击者才能完成这次攻击|漏洞利用条件非常苛刻
Affected users|所有用户，默认配置，关键用户|部分用户，非默认配置|极少数用户，匿名用户
Discoverability|漏洞很显眼，攻击条件很容易获得|在私有区域，部分人能看到，需要深入挖掘漏洞|发现该漏洞及其困难

在DREAD模型里，每一个因素都可以分为高、中、低三个等级。在上表中，高、中、低三个等级分别以3、2、1的分数代表其权重值，因此，我们可以具体计算出某一个威胁的风险值。  
介绍完威胁建模和风险分析的模型后，我们对安全评估的整体过程应该有了一个大致的了解。在任何时候都应该记住：模型是死的，人是活的，再好的模型也是需要人来使用的，在确定攻击面，以及判断风险高低时，都需要有一定的经验，这也是安全工程师的价值所在。类似STRIDE和DREAD的模型可能还有很多，不同的标准会对应不同的模型，只要我们觉得这些模型是科学的，能够帮到我们，就可以使用。但模型只能起到一个辅助的作用，最终做出决策的还是人。

### 第四个阶段：制定安全解决方案
安全评估的产出物，就是安全解决方案。
很多人认为，安全和业务是冲突的，因为往往为了安全，要牺牲业务的一些易用性或者性能，事实上并非如此。从产品的角度来说，安全也应该是产品的一种属性，一个从未考虑过安全的产品，是不完整的。（比如：我们要评价一个杯子是否好用，除了它能装水，能装多少水外，还要思考这个杯子内壁的材料是否会溶解在水里，是否会有毒，在高温时会不会熔化，在低温时是否易碎，这些问题都直接影响用户使用杯子的安全性。）  
对于互联网来说，安全是要为产品的发展与成长保驾护航的。我们不能使用“粗暴”的安全方案去阻碍产品的正常发展，所以应该形成这样一种观点：没有不安全的业务，只有不安全的实现方式。作为安全工程师，要想的就是如何通过简单而有效的方案，解决遇到的安全问题。安全方案必须能够有效抵抗威胁，但同时不能过多干涉正常的业务流程，在性能上也不能拖后腿。好的安全方案对用户应该是透明的，尽可能地不要改变用户的使用习惯。  

一个优秀的安全方案应该具备以下特点：
+ 能够有效解决问题
+ 用户体验好
+ 高性能
+ 低耦合
+ 易于扩展与升级。

## 设计安全方案

### Secure By Default原则
#### 黑名单 白名单
Secure By Default原则可以归结为黑名单白名单的思想，如果更多的使用白名单，那么系统就会变得更安全。
黑名单和白名单，简单的来讲，就是，黑名单不允许某些内容通过，其他所有情况都可以放行，而白名单仅允许预设内容通过，其他所有的情况都不可放行。其中，限制条件可以是端口、通讯协议、进程、使用者等。
黑名单的缺点在于，当出现新的威胁时，由于应对延迟总会有滞后性。白名单的缺点在于信任的基础一旦不存在了，那么安全就会荡然无存。

#### 最小权限原则
系统只需要授予主体在必要的权限，不要过度授权。
需要注意的是，需要认真梳理业务所需要的权限。

### 纵深防御（Defense in Depth）原则
+ 要在各个不同层面，不同方面实施安全方案，避免出现疏漏，不同安全方案之间需要相互配合，构成一个整体。
+ 要在正确的地方做正确的事情，即：在解决根本问题的地方实施针对性的安全方案。

### 数据与代码分离原则
这一原则适用于各种由于“注入”而引发安全问题的场景。
缓冲区溢出，也可以认为是程序违背了这一原则的后果。

### 不可预测性原则
微软使用的ASLR技术，在较新版本的Linux内核中也支持。在ASLR的控制下，一个程序每次启动时，其进程的栈基址都不相同，具有一定的随机性，对于攻击者来说，这就是“不可预测性”。
不可预测性，能有效地对抗基于篡改，伪造的攻击。
不可预测性的实现往往需要用到加密算法，随机数算法，哈希算法，好好利用这条规则，在设计安全方案时往往会事半功倍。
