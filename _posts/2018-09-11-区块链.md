---
layout: post
title: '区块链入门'
date: 2018-09-11
author: Buer
color: rgb(255,210,32)
cover: 'http://qiniu.bueryo.com/bueryo/20180620221702.jpeg'
tags: 区块链 比特币
---

# 区块链

### 总览

​	区块链本质上是一个去中心化的分布式账本数据库。其本身是一串使用密码学相关联所产生的数据块，每一个数据块中包含了多次网络交易中有效的确认信息。

### 去中心化

​	传统的交易流程是一手交钱一手交货。
	中心化集中式的处理流程，例如在淘宝上购买手机，交易流程是，买家付钱给支付宝，支付宝收款后通知卖家发货，卖家发货，买家确认收货，支付宝把钱打给卖家。
	在上面的过程中，虽然是买家卖家之间交易，但是还牵扯到了第三方，即支付宝。事实上，所有的交易都是围绕支付宝展开。因此，如果支付宝出现了问题就会导致交易失败，并且买家卖家都要向第三方提供多余的信息。考虑极端的情况，如果支付宝停电了或者拿钱不承认，那么就悲剧了。
	由此来看，去中心化的方式就简单很多，只需要卖家卖家交换钱和货物，然后双方都声称完成了这笔交易就可以了。这比一手交钱一手交货就多了一个声明的过程。
	在单笔交易中并不能完全展示去中心化的好处，试想成千上万笔交易正在进行，去中心化就可以节约很多资源，并排除了被中心代理控制的风险。
	当然，这里面就存在一个很大的潜在问题，没有了权威的中心化代理，怎样保证每笔交易的准确性和有效性呢？例如，在没有中介的情况下，Alice借了Bob100块，但是不还钱还不承认怎么办呢？

### 两个基础难题
​	去中心化以后，因为没有了作为权威的中介，那么信息的可信度和准确性直接就遇到了挑战。

##### 1. 拜占庭将军问题
​	关于拜占庭将军问题，一个简易的非正式描述如下：

​	拜占庭帝国想要进攻一个强大的敌人，为此派出了10支军队去包围这个敌人。这个敌人虽不比拜占庭帝国，但也足以抵御5支常规拜占庭军队的同时袭击。基于一些原因，这10支军队不能集合在一起单点突破，必须在分开的包围状态下同时攻击。他们任一支军队单独进攻都毫无胜算，除非有至少6支军队同时袭击才能攻下敌国。他们分散在敌国的四周，依靠通信兵相互通信来协商进攻意向及进攻时间。困扰这些将军的问题是，他们不确定他们中是否有叛徒，叛徒可能擅自变更进攻意向或者进攻时间。在这种状态下，拜占庭将军们能否找到一种分布式的协议来让他们能够远程协商，从而赢取战斗？这就是著名的拜占庭将军问题。

​	应该明确的是，拜占庭将军问题中并不去考虑通信兵是否会被截获或无法传达信息等问题，即消息传递的信道绝无问。Lamport已经证明了在消息可能丢失的不可靠信道上试图通过消息传递的方式达到一致性是不可能的。所以，在研究拜占庭将军问题的时候，我们已经假定了信道是没有问题的，并在这个前提下，去做一致性和容错性相关研究。如果需要考虑信道是有问题的，这涉及到了另一个相关问题：两军问题。

##### 2. 与拜占庭将军相关问题：两军问题
​	正如前文所说，拜占庭将军问题和两军问题实质是不一样的。国内大量解释拜占庭将军问题的文章将两者混为一谈，其实是混淆了两个问题的实质，由此造成了许多误解。这两个问题看起来的确有点相似，但是问题的前提和研究方向都截然不同。

​	白军驻扎在山谷里，蓝军则分散在山谷两边山上。白军比任何一支蓝军都更为强大，但是蓝军若能同时合力进攻则能够打败白军。他们不能够远程的沟通，只能派遣通信兵穿过山谷去通知对方蓝军协商进攻时间。是否存在一个能使蓝军必胜的通信协议，这就是两军问题。

​	看到这里您可能发现两军问题和拜占庭将军问题有一定的相似性，但我们必须注意的是，通信兵得经过敌人的山谷，在这过程中他可能被捕，也就是说，两军问题中信道是不可靠的，并且其中没有叛徒之说，这就是两军问题和拜占庭将军问题的根本性不同。由此可见，大量混淆了拜占庭将军问题和两军问题的文章并没有充分理解两者。

​	两军问题的根本问题在于信道的不可靠，反过来说，如果传递消息的信道是可靠的，两军问题可解。然而，并不存在这样一种信道，所以两军问题在经典情境下是不可解的，为什么呢？

​	倘若1号蓝军（简称1）向2号蓝军（简称2）派出了通信兵，若1要知道2是否收到了自己的信息，1必须要求2给自己传输一个回执，说“你的信息我已经收到了，我同意你提议的明天早上10点9分准时进攻”。

​	然而，就算2已经送出了这条信息，2也不能确定1就一定会在这个时间进攻，因为2发出的回执1并不一定能够收到。所以，1必须再给2发出一个回执说“我收到了”，但是1也不会知道2是否收到了这样一个回执，所以1还会期待一个2的回执。

​	虽然看似很可笑，但在这个系统中永远需要存在一个回执，这对于两方来说都并不一定能够达成十足的确信。更要命的是，我们还没有考虑，通信兵的信息还有可能被篡改。由此可见，经典情形下两军问题是不可解的，并不存在一个能使蓝军一定胜利的通信协议。

​	不幸的是，两军问题作为现代通信系统中必须解决的问题，我们尚不能将之完全解决，这意味着你我传输信息时仍然可能出现丢失、监听或篡改的情况。但我们能不能通过一种相对可靠的方式来解决大部分情形呢？这需要谈到TCP协议。事实上，搜索“两军问题与三次握手”，一定可以找到大量与TCP协议相关的内容。

​	TCP协议中，A先向B发出一个随机数x，B收到x了以后，发给A另一个随机数y以及x+1作为答复，这样A就知道B已经收到了，因为要破解随机数x可能性并不大；然后A再发回y+1给B，这样B就知道A已经收到了。这样，A和B之间就建立一个可靠的连接，彼此相信对方已经收到并确认了信息。

​	而事实上，A并不会知道B是否收到了y+1；并且，由于信道的不可靠性，x或者y都是可能被截获的，这些问题说明了即使是三次握手，也并不能够彻底解决两军问题，只是在现实成本可控的条件下，我们把TCP协议当作了两军问题的现实可解方法。

​	这两个问题反映到信息领域来，可以理解为一个去中心的系统中，有一些节点是坏掉的，他们可能会传播错误的信息或者不传播信息，在这种情况下如何验证数据传输的准确性。

​	这里就不再继续深入这两个问题了。

### 区块链技术的诞生
​	下面我们来建立一个去中心化的系统，然后一步步解决这些问题，见证区块链技术雏形的诞生。

1.首先，我们建立一个去中心化的系统。为了便于理解，我们来看一个简单的去中心化的借贷模型：A借给了B100块！”，B也在人群中喊，“我是B，A借给了我100块！”，这时吃瓜群众都听到了这个消息，因此所有的人都在自家本子上记下了“A给了B100块”。这样，一个去中心化的系统就建立起来了，这个跟系统中不需要银行，也不需要借条和收据，严格来说，甚至不需要人与人之间长久的信任关系（比如B突然改口说“我不欠A的钱！”，这时候人民群众就会站出来说“部队，我的本子上记录了你某天借了A100块”）。

2.在上述模型中，所谓的“100块”已经不重要了，换句话说，在这个模型中，什么东西都可以交换，甚至你凭空杜撰出来一个东西，只要大家承认，你就可以让你杜撰的东西流通。比如：我在人群中高喊一声“我炼出来10颗长生不老的仙丹！”，我甚至不需要知道仙丹长啥样，甚至不需要关心世界上是不是真的有仙丹，只要大家听到并在自己小本本上记下了“L有10颗仙丹”，于是我就真的有10颗仙丹了。从此以后，我便可以声称我给了某人一颗仙丹，只要吃瓜群众们都收到并且承认了这一信息，那我就算完成了这次交易，哪怕世界上没有仙丹。是不是联想到了“比特币”？真正的区块链和比特币比我上述描述的复杂太多，细节也丰富太多，因此还是以仙丹举例。

3.假设过了很长时间，我凭空创造的仙丹已经开始流通，大家都认可了仙丹。但这系统中只有10个仙丹，于是有人动了坏心思，他在人群中高呼“我有10个仙丹！”怎么办？大家直接记录么，这样不是人人都可以伪造仙丹了么？
	为了防止这种现象发生，我决定在我创造仙丹的时候给我的仙丹打上标记（更准确地说，我是给我喊的那句“我创造了10颗仙丹”打上标记，比如标记为001），这样以后在每一笔交易的时候，我在高喊“我给了某某1个仙丹！”的时候，会附加上额外的一句话：“这1个仙丹的来源是记为001的那条记录，我的这句话标记为002！”。我们再抽象一点，某人喊话的内容的格式就变成了：“这句话编号xxx，上一句话的编号是yyy，我给了某某1个仙丹！”，这样就解决了伪造的问题。其实上述模型就变成一个简化的中本聪第一版比特币区块链协议：<img src="https://pic1.zhimg.com/129eca5e26cdaf3de77b9a8cffa296a8_b.jpg" data-rawwidth="794" data-rawheight="533" class="origin_image zh-lightbox-thumb" width="794" data-original="https://pic1.zhimg.com/129eca5e26cdaf3de77b9a8cffa296a8_r.jpg">
到了这里，基本上已经可以生动形象的解释区块链了，但是有几个常见问题需要回答。
- “凭啥？”
    “凭啥你喊一句我就帮你记？我的本子不要钱么？”。为了激励大家帮我传话和记账，我决定给第一个听到我汉化并且记录的人一些奖励：第一个听到我喊话并记录下来的人，你就凭空得到了1颗仙丹，这颗长生不老的仙丹是整个系统对你辛苦记录的报酬，而你记录了这句话之后，要马上告诉其他人你已经记录好了，让别人放弃记录这句话，并给你自己的记录编号，让别人有据可查，然后再把我的话加上你的记录编号一起喊出来，供下一个人记账。
    当这个规则定下以后，这个系统中一定会出现一批人，他们时刻准备着监听声音，以抢占第一个记账的权利。这里，是不是又想到了“比特币挖矿”？
    关于比特币挖矿，这里有个很形象的例子：
    >单身汪们要找女票，国民岳母说我有好多女儿，这样吧我给你们出点题目，解出一个就给其中一个姑娘的微信号。单身汪们疯狂竞争，想破脑袋去解题。只要其中一只汪解出一道题，就立马得意洋洋地昭告天下，示威全部单身汪，这个姑娘是我的啦，你们放弃吧。其他单身汪们即使不服也没有办法，惆怅懊恼也不是个事儿啊，还是麻溜地立马去解下一道题目吧。这只喜赢姑娘的幸运小汪被岳母认可后还能得到25个货币单位的彩礼，简直人生赢家。
- “听谁的？”
在这个系统中，如果我和另一个人C几乎同时地喊出一句：“兽人永不为奴！”。由于听众所处的位置不同，一定会有人先听到我说的那句话，而另外一些人则先听到C的那句话，如果我们规定只能有一个人说出这句话，那到底这句话是谁说的？如果不加任何条件，那么上述的情况一定会这样发展：一部分人认为这句话是我说的，在听到这句话之后开始记账，之后他们所做的所有事情都是基于这个事实，并且随着这个信息一次次的传下去，这条信息链会越来越深；而另外一群认为是C先说这句话的人，也会按照这样的趋势发展。这样，原本是一条唯一的信息链，在我们喊出“兽人永不为奴！”这句话之后，分叉了！？
<img src="https://pic3.zhimg.com/5e564510dae5b6cffa111c38ec271fea_b.jpg" data-rawwidth="851" data-rawheight="488" class="origin_image zh-lightbox-thumb" width="851" data-original="https://pic3.zhimg.com/5e564510dae5b6cffa111c38ec271fea_r.jpg">

按照我们的设想，每个人的本子上记录的东西都应该是一样的，是一条可以把所有信息串起来的链条。但是在这一刻，小本子上的记录不一样了，这怎么确定交易和信息的真实性？

为了解决这个问题，我又追加了新的规则：每个人在记录小本本的时候，需要脱鞋然后用脚拿笔，在小本本上用正楷体书写！有了这个规定，由于用脚写字难度很大，每个人至少需要10分钟才能写完，而且由于每个人用脚写字的熟练度不通，写完这句话所用的时间也不同，因此一定会有人先写完然后高呼“我写完了！那句话是L喊的！”，这样其它正在写这句话的人便会停笔，然后在小本本上重新开始写“那句话是来文写的，上一句的编号是xxx”。

上面的解决方案，可以对应了解以下知识：
“听谁的”——中本聪破解“拜占庭将军问题”的算法

“在小本本上记录”——比特币挖矿

“脱鞋用脚写字”——比特币挖矿难度

“脱鞋写字速度”——算力

“新的规则”——工作量证明链

### 更加详细的内容
未完待续……